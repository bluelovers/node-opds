{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["import { BeforeDeserialized, JsonElementType, JsonProperty, JsonWriteonly } from 'ta-json-x';\nimport { Schema } from '../class';\nimport '../debug';\nimport { EnumEntryContent, EnumLinkRel, EnumMIME, REL_BASE_URL } from '../const';\nimport { getOPDSRel, hrefURL, typedOrObjectList } from '../util';\nimport moment = require(\"moment\");\nimport opds = require(\"../..\");\n\nexport class Price extends Schema.Base\n{\n\t@JsonProperty()\n\tpublic currencycode: string;\n\n\t@JsonProperty()\n\tpublic value: number;\n}\n\nexport class Link extends Schema.Base\n{\n\tprotected _href: string | URL;\n\n\t@JsonProperty()\n\tpublic get href()\n\t{\n\t\tif (typeof this._href === 'string')\n\t\t{\n\t\t\treturn this._href\n\t\t}\n\t\telse if (this._href && typeof this._href.href === 'string')\n\t\t{\n\t\t\treturn this._href.href\n\t\t}\n\t}\n\n\tpublic set href(value: string | URL)\n\t{\n\t\tlet r = hrefURL(value);\n\n\t\tif (r != null)\n\t\t{\n\t\t\tthis._href = r;\n\t\t}\n\t}\n\n\t@JsonProperty()\n\tpublic rel: string;\n\n\t@JsonProperty()\n\tpublic title: string | EnumLinkRel;\n\n\t@JsonProperty()\n\tpublic type: string | EnumMIME;\n\n\tprotected _price: (Price | number)[];\n\n\t@JsonProperty()\n\tpublic get price()\n\t{\n\t\tif (this._price != null)\n\t\t{\n\t\t\tif (!Array.isArray(this._price))\n\t\t\t{\n\t\t\t\treturn this._price\n\t\t\t}\n\t\t\telse if (this._price.length == 1)\n\t\t\t{\n\t\t\t\treturn this._price[0]\n\t\t\t}\n\t\t}\n\n\t\treturn;\n\t}\n\n\t@JsonProperty()\n\tpublic get prices()\n\t{\n\t\tif (Array.isArray(this._price) && this._price.length > 1)\n\t\t{\n\t\t\treturn this._price;\n\t\t}\n\t}\n\n\t/**\n\t * @alias price\n\t */\n\tpublic set prices(value: Price | number | (Price | number)[])\n\t{\n\t\tthis.price = value;\n\t}\n\n\tpublic set price(value: Price | number | (Price | number)[])\n\t{\n\t\tlet r = typedOrObjectList<number, Price>(value, 'number', Price);\n\n\t\tif (r != null)\n\t\t{\n\t\t\tthis._price = r;\n\t\t}\n\t}\n\n\tpublic getRelFullURL()\n\t{\n\t\tif (this.rel)\n\t\t{\n\t\t\treturn getOPDSRel(this.rel)\n\t\t\t//return new URL(this.rel, REL_BASE_URL).href\n\t\t}\n\t}\n\n\t/**\n\t * 語系\n\t */\n\t@JsonProperty()\n\threflang?: string;\n\n\t/**\n\t * 連結內容的大小，當rel為enclosure時，應該要有此屬性\n\t */\n\t@JsonProperty()\n\tlength?: number;\n\n}\n\nexport class Author extends Schema.Base<IFeed>\n{\n\t@JsonProperty()\n\tpublic name: string;\n\n\t@JsonProperty()\n\tpublic uri?: string;\n\n\t@JsonProperty()\n\tpublic email?: string;\n}\n\nexport class EntryContent extends Schema.Base<IFeed>\n{\n\t@JsonProperty()\n\tpublic type: string | EnumEntryContent;\n\n\t@JsonProperty()\n\tpublic value: string;\n}\n\nexport class EntryCategory extends Schema.Base<IFeed>\n{\n\t@JsonProperty()\n\tpublic term: string;\n\n\t@JsonProperty()\n\tpublic label?: string;\n\n\t@JsonProperty()\n\tpublic scheme?: string;\n}\n\nexport class Entry extends Schema.Base<IFeed>\n{\n\t@JsonProperty()\n\tpublic id: string;\n\n\t@JsonProperty()\n\tpublic identifier: string;\n\n\t@JsonProperty()\n\tpublic title: string;\n\n\t@JsonProperty()\n\t@JsonElementType(Author)\n\tpublic authors?: Author[];\n\n\tprotected _updated: moment.Moment;\n\n\t@JsonProperty()\n\tpublic get updated()\n\t{\n\t\tif (this._updated)\n\t\t{\n\t\t\treturn this._updated.toDate()\n\t\t}\n\t}\n\n\tpublic set updated(_updated: moment.MomentInput)\n\t{\n\t\tthis._updated = moment.isMoment(_updated) ? _updated : moment(_updated);\n\t}\n\n\tprotected _published: moment.Moment;\n\n\t@JsonProperty()\n\tpublic get published()\n\t{\n\t\tif (this._published)\n\t\t{\n\t\t\treturn this._published.toDate()\n\t\t}\n\t}\n\n\tpublic set published(_updated: moment.MomentInput)\n\t{\n\t\tthis._published = moment.isMoment(_updated) ? _updated : moment(_updated);\n\t}\n\n\tprotected _issued: moment.Moment;\n\n\t@JsonProperty()\n\tpublic get issued()\n\t{\n\t\tif (this._issued)\n\t\t{\n\t\t\treturn this._issued.toDate()\n\t\t}\n\t}\n\n\tpublic set issued(_updated: moment.MomentInput)\n\t{\n\t\tthis._issued = moment.isMoment(_updated) ? _updated : moment(_updated);\n\t}\n\n\t@JsonProperty()\n\t@JsonElementType(Link)\n\tpublic links: Link[];\n\n\t@JsonProperty()\n\tpublic summary?: string;\n\n\t@JsonProperty()\n\tpublic content?: EntryContent;\n\n\tprotected _categories?: (string|EntryCategory)[];\n\n\t@JsonProperty()\n\tpublic get categories()\n\t{\n\t\tif (Array.isArray(this._categories) && this._categories.length)\n\t\t{\n\t\t\treturn this._categories;\n\t\t}\n\t}\n\n\tpublic set categories(value: EntryCategory | string | (EntryCategory | string)[])\n\t{\n\t\tlet r = typedOrObjectList<string, EntryCategory>(value, 'string', EntryCategory);\n\n\t\tif (r != null)\n\t\t{\n\t\t\tthis._categories = r;\n\t\t}\n\t}\n\n\t@JsonProperty()\n\t@JsonElementType(URL)\n\t@JsonWriteonly()\n\tpublic set image(url: string | URL)\n\t{\n\t\tlet r = hrefURL(url);\n\n\t\tif (r != null)\n\t\t{\n\t\t\tthis.links = (this.links || [])\n\t\t\t\t.filter(v => v.rel != EnumLinkRel.IMAGE)\n\t\t\t;\n\n\t\t\tlet u = new Link();\n\t\t\tu.href = r;\n\t\t\tu.rel = EnumLinkRel.IMAGE;\n\t\t\tu.type = EnumMIME.jpg;\n\n\t\t\tthis.links.push(u);\n\t\t}\n\t}\n\n\t@JsonProperty()\n\tpublic publisher?: string;\n\n\t@JsonProperty()\n\tpublic language?: string;\n\n\t@JsonProperty()\n\tpublic rights?: string;\n\n\t@JsonProperty()\n\tpublic source?: string;\n}\n\nexport interface IFeed extends Schema.IBaseJSON\n{\n\tid?: string;\n\ttitle?: string;\n\ticon?: string;\n}\n\nexport class Feed extends Schema.Base<IFeed>\n{\n\n\t@BeforeDeserialized()\n\tprotected BeforeDeserialized()\n\t{\n\t\tthis._updated = moment();\n\t}\n\n\t@JsonProperty()\n\tpublic id?: string;\n\n\t@JsonProperty()\n\tpublic title: string;\n\t@JsonProperty()\n\tpublic subtitle: string;\n\n\t@JsonProperty()\n\tpublic icon?: string;\n\n\tprotected _updated: moment.Moment;\n\n\t@JsonProperty('updated')\n\tpublic get updated()\n\t{\n\t\treturn (this._updated).toDate()\n\t}\n\n\tpublic set updated(_updated: moment.MomentInput)\n\t{\n\t\tthis._updated = moment.isMoment(_updated) ? _updated : moment(_updated);\n\t}\n\n\t@JsonProperty()\n\t@JsonElementType(Author)\n\tpublic authors?: Author[];\n\n\t@JsonProperty()\n\t@JsonElementType(Link)\n\tpublic links?: Link[];\n\n\t@JsonProperty()\n\t@JsonElementType(Entry)\n\tpublic books?: Entry[];\n\n\ttoOPDS()\n\t{\n\t\treturn opds.create(this.serialize())\n\t}\n\n\t@JsonProperty()\n\tpublic source?: string;\n}\n\nexport default exports as typeof import('./index');\n\n\n"]}